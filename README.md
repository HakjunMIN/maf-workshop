# Microsoft Agent Framework Workshop

Microsoft Agent Frameworkë¥¼ í™œìš©í•œ AI ì—ì´ì „íŠ¸ ê°œë°œ ì›Œí¬ìƒµì…ë‹ˆë‹¤. ì´ ì›Œí¬ìƒµì—ì„œëŠ” ì±„íŒ…, ì—ì´ì „íŠ¸, Azure AI í†µí•©, MCP, ì¥ê¸° ë©”ëª¨ë¦¬, ë¯¸ë“¤ì›¨ì–´, ê·¸ë¦¬ê³  Observabilityê¹Œì§€ ë‹¤ì–‘í•œ ì£¼ì œë¥¼ ë‹¤ë£¹ë‹ˆë‹¤.

## ğŸ“š ì›Œí¬ìƒµ êµ¬ì„±

ì´ ì›Œí¬ìƒµì€ 8ê°œì˜ Jupyter Notebookìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆìœ¼ë©°, ê° ë…¸íŠ¸ë¶ì€ ë…ë¦½ì ìœ¼ë¡œ í•™ìŠµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 1ï¸âƒ£ Chat (01. chat.ipynb)
ê¸°ë³¸ì ì¸ ì±„íŒ… ê¸°ëŠ¥ êµ¬í˜„ì„ í•™ìŠµí•©ë‹ˆë‹¤.

**í•™ìŠµ ë‚´ìš©:**
- Azure OpenAI Chat Client ê¸°ë³¸ ì‚¬ìš©ë²•
- ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ì²˜ë¦¬
- ëŒ€í™” ì´ë ¥ ê´€ë¦¬
- ì‹œìŠ¤í…œ ë©”ì‹œì§€ì™€ ì‚¬ìš©ì ë©”ì‹œì§€ êµ¬ì„±

**ì£¼ìš” ì˜ˆì œ:**
- ê¸°ë³¸ ì±„íŒ… êµ¬í˜„
- ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ì²˜ë¦¬
- ëŒ€í™” ì»¨í…ìŠ¤íŠ¸ ìœ ì§€

---

### 2ï¸âƒ£ Agent (02. agent.ipynb)
AI ì—ì´ì „íŠ¸ì˜ ê¸°ë³¸ ê°œë…ê³¼ ë„êµ¬(Tool) ì‚¬ìš©ë²•ì„ í•™ìŠµí•©ë‹ˆë‹¤.

**í•™ìŠµ ë‚´ìš©:**
- Agentì˜ ê°œë…ê³¼ êµ¬ì„± ìš”ì†Œ
- Function Callingì„ í†µí•œ ë„êµ¬ ì •ì˜
- ë³µì¡í•œ ë„êµ¬ ì²´ì¸ êµ¬ì„±
- êµ¬ì¡°í™”ëœ ì¶œë ¥ (Structured Output)
- ì½”ë“œ ì¸í„°í”„ë¦¬í„° ì‚¬ìš©

**ì£¼ìš” ì˜ˆì œ:**
- ë‚ ì”¨ ì •ë³´ ì¡°íšŒ Agent
- ê³„ì‚°ê¸° Agent
- ë¹„ì „ ëª¨ë¸ì„ í™œìš©í•œ ì´ë¯¸ì§€ ë¶„ì„
- ì—¬ëŸ¬ ë„êµ¬ë¥¼ ì¡°í•©í•œ ë³µí•© Agent

---

### 3ï¸âƒ£ Azure AI Integration (03. azure_ai.ipynb)
Azure AI ì„œë¹„ìŠ¤ì™€ì˜ í†µí•©ì„ í•™ìŠµí•©ë‹ˆë‹¤.

**í•™ìŠµ ë‚´ìš©:**
- Azure AI Project ì„¤ì •
- Azure AI Agent Client ì‚¬ìš©
- Azure ì¸ì¦ ë°©ë²•
- Azure AI ë¦¬ì†ŒìŠ¤ í™œìš©

**ì£¼ìš” ì˜ˆì œ:**
- Azure AI Agent ìƒì„±
- Azure ì¸ì¦ ì„¤ì •
- Azure ë¦¬ì†ŒìŠ¤ì™€ í†µí•©

---

### 4ï¸âƒ£ MCP - Model Context Protocol (04. mcp.ipynb)
MCPë¥¼ ì‚¬ìš©í•˜ì—¬ Agentë¥¼ ì„œë¹„ìŠ¤ë¡œ ë…¸ì¶œí•˜ëŠ” ë°©ë²•ì„ í•™ìŠµí•©ë‹ˆë‹¤.

**í•™ìŠµ ë‚´ìš©:**
- MCPì˜ ê°œë…ê³¼ ì‘ë™ ë°©ì‹
- Agentë¥¼ MCP Serverë¡œ ë…¸ì¶œí•˜ê¸°
- MCP ì¸ì¦ (API Key, Bearer Token)
- MCP ë„êµ¬ë¥¼ Agentì— í†µí•©
- Claude Desktop, VS Code Copilot ì—°ë™

**ì£¼ìš” ì˜ˆì œ:**
- ë ˆìŠ¤í† ë‘ ë©”ë‰´ Agentë¥¼ MCP Serverë¡œ ë…¸ì¶œ
- API Key ì¸ì¦ êµ¬í˜„
- ë²ˆì—­ ì„œë¹„ìŠ¤ Agent
- ë‚ ì”¨ ì •ë³´ ì„œë¹„ìŠ¤ Agent

---

### 5ï¸âƒ£ Long-term Memory (05. long_term_memory.ipynb)
ì¥ê¸° ì»¨í…ìŠ¤íŠ¸ ê¸°ì–µ(Long-term Memory) êµ¬í˜„ ë°©ë²•ì„ í•™ìŠµí•©ë‹ˆë‹¤.

**í•™ìŠµ ë‚´ìš©:**
- Context Providerì˜ ê°œë…
- ì»¤ìŠ¤í…€ Context Provider êµ¬í˜„
- Mem0 Context Provider ì‚¬ìš©
- Redis Context Provider ì‚¬ìš©
- Thread ê´€ë¦¬ ë° ìŠ¤ì½”í•‘ ì „ëµ

**ì£¼ìš” ì˜ˆì œ:**
- ì‚¬ìš©ì ì •ë³´ ê¸°ì–µí•˜ëŠ” ì»¤ìŠ¤í…€ Provider
- Mem0 Platform í™œìš©
- Mem0 OSS (Open Source) ì‚¬ìš©
- Redisë¥¼ í™œìš©í•œ í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰
- Global/Per-operation Thread Scope
- Multiple Agents ë©”ëª¨ë¦¬ ê²©ë¦¬

---

### 6ï¸âƒ£ Middleware (06. middleware.ipynb)
Agentì˜ ìš”ì²­/ì‘ë‹µ ì²˜ë¦¬ ê³¼ì •ì— ê°œì…í•˜ëŠ” Middlewareë¥¼ í•™ìŠµí•©ë‹ˆë‹¤.

**í•™ìŠµ ë‚´ìš©:**
- Middlewareì˜ ê°œë…ê³¼ ì‘ë™ ë°©ì‹
- ì»¤ìŠ¤í…€ Middleware êµ¬í˜„
- ë¡œê¹… Middleware
- ìºì‹± Middleware
- ì—ëŸ¬ í•¸ë“¤ë§ Middleware

**ì£¼ìš” ì˜ˆì œ:**
- ìš”ì²­/ì‘ë‹µ ë¡œê¹…
- ì‘ë‹µ ìºì‹±ìœ¼ë¡œ ì„±ëŠ¥ ìµœì í™”
- ì—ëŸ¬ ë°œìƒ ì‹œ ìë™ ì¬ì‹œë„
- ì—¬ëŸ¬ Middleware ì²´ì¸ êµ¬ì„±

---

### 7ï¸âƒ£ Observability (07. observability.ipynb)
Agentì˜ ëª¨ë‹ˆí„°ë§ê³¼ ì¶”ì ì„ ìœ„í•œ Observabilityë¥¼ í•™ìŠµí•©ë‹ˆë‹¤.

**í•™ìŠµ ë‚´ìš©:**
- OpenTelemetry í†µí•©
- ë¶„ì‚° ì¶”ì  (Distributed Tracing)
- ë©”íŠ¸ë¦­ ìˆ˜ì§‘
- ë¡œê·¸ ì§‘ê³„
- Azure Monitor í†µí•©

**ì£¼ìš” ì˜ˆì œ:**
- OpenTelemetry ì„¤ì •
- Traceì™€ Span ìƒì„±
- ì»¤ìŠ¤í…€ ë©”íŠ¸ë¦­ ì¶”ê°€
- Azure Application Insights ì—°ë™

---

### 8ï¸âƒ£ Evaluation - Red Teaming (08. eval.ipynb)
Azure AI Evaluationì„ ì‚¬ìš©í•˜ì—¬ AI ì—ì´ì „íŠ¸ì˜ ì•ˆì „ì„±ê³¼ ê²¬ê³ ì„±ì„ í‰ê°€í•˜ëŠ” ë°©ë²•ì„ í•™ìŠµí•©ë‹ˆë‹¤.

**í•™ìŠµ ë‚´ìš©:**
- Red Teamingì˜ ê°œë…ê³¼ ì¤‘ìš”ì„±
- Azure AI Evaluation Red Team ê¸°ëŠ¥
- ìœ„í—˜ ì¹´í…Œê³ ë¦¬ (Violence, Hate/Unfairness, Sexual, Self-Harm)
- ë‹¤ì–‘í•œ ê³µê²© ì „ëµ (ì¸ì½”ë”©, ë‚œë…í™” ê¸°ë²•)
- í‰ê°€ ê²°ê³¼ ë¶„ì„ ë° í•´ì„
- ì•ˆì „ ê°€ì´ë“œë¼ì¸ ê°•í™” ë°©ë²•

**ì£¼ìš” ì˜ˆì œ:**
- ê¸ˆìœµ ìë¬¸ Agent Red Team í‰ê°€
- 11ê°€ì§€ ê³µê²© ì „ëµ ì ìš©
- í‰ê°€ ê²°ê³¼ ìŠ¤ì½”ì–´ì¹´ë“œ ë¶„ì„
- ê°œì„ ëœ ì•ˆì „ í”„ë¡¬í”„íŠ¸ êµ¬í˜„
- ì ëŒ€ì  ê³µê²© ì‹œë®¬ë ˆì´ì…˜

---

## ğŸš€ ì‹œì‘í•˜ê¸°

### ì‚¬ì „ ìš”êµ¬ì‚¬í•­

- Python 3.12 ì´ìƒ
- Azure OpenAI ë¦¬ì†ŒìŠ¤ ë˜ëŠ” OpenAI API í‚¤
- (ì„ íƒ) Azure AI Project
- (ì„ íƒ) Redis (Long-term Memory ì‹¤ìŠµìš©)
- (ì„ íƒ) Mem0 API í‚¤ (Long-term Memory ì‹¤ìŠµìš©)

### ì„¤ì¹˜

1. **ì €ì¥ì†Œ í´ë¡ **
   ```bash
   git clone <repository-url>
   cd maf-workshop
   ```

2. **ê°€ìƒ í™˜ê²½ ìƒì„± ë° í™œì„±í™”**
   
   **UV ì‚¬ìš© (ê¶Œì¥):**
   ```bash
   uv venv
   source .venv/bin/activate  # macOS/Linux
   # ë˜ëŠ”
   .venv\Scripts\activate  # Windows
   ```

   **ë˜ëŠ” Python venv ì‚¬ìš©:**
   ```bash
   python -m venv .venv
   source .venv/bin/activate  # macOS/Linux
   # ë˜ëŠ”
   .venv\Scripts\activate  # Windows
   ```

3. **íŒ¨í‚¤ì§€ ì„¤ì¹˜**
   
   **UV ì‚¬ìš©:**
   ```bash
   uv pip install -e .
   ```

   **ë˜ëŠ” pip ì‚¬ìš©:**
   ```bash
   pip install -e .
   ```

4. **í™˜ê²½ ë³€ìˆ˜ ì„¤ì •**
   
   `.env` íŒŒì¼ì„ ìƒì„±í•˜ê³  ë‹¤ìŒ ë‚´ìš©ì„ ì¶”ê°€í•©ë‹ˆë‹¤:

   ```env
   # Azure OpenAI ì„¤ì • (í•„ìˆ˜)
   AZURE_OPENAI_ENDPOINT=https://your-resource.openai.azure.com
   AZURE_OPENAI_API_KEY=your-api-key
   AZURE_OPENAI_CHAT_DEPLOYMENT_NAME=gpt-4
   
   # Azure AI Project ì„¤ì • (ì„ íƒ)
   AZURE_AI_PROJECT_ENDPOINT=https://your-project.api.azureml.ms
   AZURE_AI_MODEL_DEPLOYMENT_NAME=gpt-4
   
   # Mem0 ì„¤ì • (ì„ íƒ - Long-term Memory ì‹¤ìŠµìš©)
   MEM0_API_KEY=your-mem0-api-key
   
   # Redis ì„¤ì • (ì„ íƒ - Long-term Memory ì‹¤ìŠµìš©)
   REDIS_URL=redis://localhost:6379
   
   # Observability ì„¤ì • (ì„ íƒ - Observability ì‹¤ìŠµìš©)
   ENABLE_OTEL=true
   OTLP_ENDPOINT=localhost:4317
   ```

5. **Jupyter ì‹¤í–‰**
   ```bash
   jupyter lab
   # ë˜ëŠ”
   jupyter notebook
   ```

---

## ğŸ“– í•™ìŠµ ê°€ì´ë“œ

### ì¶”ì²œ í•™ìŠµ ìˆœì„œ

1. **ê¸°ì´ˆ ë‹¨ê³„** (í•„ìˆ˜)
   - 01. Chat â†’ 02. Agent â†’ 03. Azure AI Integration

2. **ê³ ê¸‰ ê¸°ëŠ¥** (ì„ íƒ)
   - 04. MCP â†’ 05. Long-term Memory

3. **ìš´ì˜ ë° ëª¨ë‹ˆí„°ë§** (ì„ íƒ)
   - 06. Middleware â†’ 07. Observability

4. **ì•ˆì „ì„± í‰ê°€** (ì„ íƒ)
   - 08. Evaluation (Red Teaming)

### ê° ë…¸íŠ¸ë¶ í•™ìŠµ ì‹œê°„

- Chat: 30ë¶„
- Agent: 1ì‹œê°„
- Azure AI Integration: 30ë¶„
- MCP: 1ì‹œê°„
- Long-term Memory: 1.5ì‹œê°„
- Middleware: 45ë¶„
- Observability: 1ì‹œê°„
- Evaluation (Red Teaming): 1.5ì‹œê°„ (í‰ê°€ ì‹¤í–‰ ì‹œê°„ í¬í•¨)

**ì´ í•™ìŠµ ì‹œê°„: ì•½ 7.5ì‹œê°„**

## ğŸ’¡ ì£¼ìš” í•™ìŠµ í¬ì¸íŠ¸

### 1. Agent ì„¤ê³„ íŒ¨í„´
```python
# ë„êµ¬ ì •ì˜
def get_weather(city: str) -> str:
    return f"{city}ì˜ ë‚ ì”¨ ì •ë³´"

# Agent ìƒì„±
agent = client.create_agent(
    name="WeatherAgent",
    instructions="ë‚ ì”¨ ì •ë³´ë¥¼ ì œê³µí•˜ëŠ” Assistant",
    tools=[get_weather]
)

# ì‹¤í–‰
result = await agent.run("ì„œìš¸ ë‚ ì”¨ ì•Œë ¤ì¤˜")
```

### 2. Context Provider í™œìš©
```python
# ì»¤ìŠ¤í…€ Context Provider
class CustomMemory(ContextProvider):
    async def invoking(self, messages, **kwargs):
        # ì»¨í…ìŠ¤íŠ¸ ì œê³µ
        return Context(instructions="ì¶”ê°€ ì§€ì‹œì‚¬í•­")
    
    async def invoked(self, request_messages, response_messages, **kwargs):
        # ë©”ëª¨ë¦¬ ì—…ë°ì´íŠ¸
        pass
```

### 3. MCP Server ë…¸ì¶œ
```python
# Agentë¥¼ MCP Serverë¡œ ë…¸ì¶œ
server = agent.as_mcp_server()

# Claude Desktop, VS Codeì—ì„œ ì‚¬ìš© ê°€ëŠ¥
```

### 4. Middleware ì²´ì¸
```python
# ì—¬ëŸ¬ Middleware ì¡°í•©
agent = ChatAgent(
    chat_client=client,
    middlewares=[
        LoggingMiddleware(),
        CachingMiddleware(),
        ErrorHandlingMiddleware()
    ]
)
```

---

## ğŸ”§ ë¬¸ì œ í•´ê²°

### ì¼ë°˜ì ì¸ ë¬¸ì œ

#### 1. Azure OpenAI ì—°ê²° ì˜¤ë¥˜
```
AuthenticationError: Incorrect API key provided
```
**í•´ê²°ë°©ë²•:** `.env` íŒŒì¼ì˜ `AZURE_OPENAI_API_KEY`ë¥¼ í™•ì¸í•˜ì„¸ìš”.

#### 2. ì½”ë“œ ì¸í„°í”„ë¦¬í„° ë¦¬ì „ ì˜¤ë¥˜
```
BadRequestError: Code interpreter tool cannot be used in this region
```
**í•´ê²°ë°©ë²•:** ë…¸íŠ¸ë¶ì— í¬í•¨ëœ ëŒ€ì²´ í•¨ìˆ˜ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.

#### 3. Redis ì—°ê²° ì˜¤ë¥˜
```
ConnectionError: Error connecting to Redis
```
**í•´ê²°ë°©ë²•:** 
```bash
# Dockerë¡œ Redis ì‹¤í–‰
docker run --name redis -p 6379:6379 -d redis:8.0.3

# ê¸°ì¡´ ì»¨í…Œì´ë„ˆ ì‹œì‘
docker start redis
```

#### 4. Mem0 API ì˜¤ë¥˜
```
ValidationError: Filters are required and cannot be empty
```
**í•´ê²°ë°©ë²•:** `application_id`ì™€ `agent_id`ë¥¼ ëª¨ë‘ ì œê³µí•˜ì„¸ìš”.

---

## ğŸ“š ì°¸ê³  ìë£Œ

### ê³µì‹ ë¬¸ì„œ
- [Microsoft Agent Framework](https://github.com/microsoft/agent-framework)
- [Azure OpenAI Service](https://learn.microsoft.com/azure/ai-services/openai/)
- [Model Context Protocol](https://modelcontextprotocol.io/)
- [Mem0 Documentation](https://docs.mem0.ai/)

### ì¶”ê°€ í•™ìŠµ ìë£Œ
- [Azure AI Studio](https://ai.azure.com/)
- [OpenTelemetry Python](https://opentelemetry.io/docs/languages/python/)
- [Redis Vector Search](https://redis.io/docs/stack/search/reference/vectors/)
- [Azure AI Evaluation](https://learn.microsoft.com/azure/ai-services/openai/concepts/evaluation)
- [Responsible AI Guidelines](https://learn.microsoft.com/azure/ai-services/openai/concepts/responsible-ai)
- [PyRIT - Python Risk Identification Toolkit](https://github.com/Azure/PyRIT)

---

## ğŸ“ ë¼ì´ì„ ìŠ¤

ì´ í”„ë¡œì íŠ¸ëŠ” MIT ë¼ì´ì„ ìŠ¤ í•˜ì— ë°°í¬ë©ë‹ˆë‹¤.

---

## ğŸ’¬ ë¬¸ì˜ ë° ì§€ì›

ì§ˆë¬¸ì´ë‚˜ ë¬¸ì œê°€ ìˆìœ¼ì‹œë©´ ì´ìŠˆë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš”.

---

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„

ì›Œí¬ìƒµì„ ì™„ë£Œí•œ í›„:

1. **í”„ë¡œë•ì…˜ ë°°í¬**: Azure Container Apps ë˜ëŠ” App Serviceì— ë°°í¬
2. **CI/CD êµ¬ì„±**: GitHub Actions ë˜ëŠ” Azure DevOps íŒŒì´í”„ë¼ì¸ ì„¤ì •
3. **ëª¨ë‹ˆí„°ë§**: Azure Application Insightsì™€ í†µí•©
4. **ë³´ì•ˆ ê°•í™”**: Azure Key Vaultë¡œ ì‹œí¬ë¦¿ ê´€ë¦¬
5. **ì„±ëŠ¥ ìµœì í™”**: ìºì‹±, ë°°ì¹˜ ì²˜ë¦¬ ë“± ì ìš©

---

**Happy Learning! ğŸš€**
